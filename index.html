<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Toy Sales Tracker</title>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.6.8/firebase-analytics.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
        }
        h1 {
            text-align: center;
            color: #333;
        }
        form {
            max-width: 400px;
            margin: 0 auto;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input[type="text"],
        input[type="number"],
        input[type="date"],
        select {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            display: block;
            width: 100%;
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background-color: #45a049;
        }
        hr {
            margin: 20px 0;
            border: none;
            border-top: 1px solid #ccc;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            padding: 8px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        #paymentSummary {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <h1>Toy Sales Tracker</h1>
    <form>
        <label for="toyName">Toy Name:</label>
        <input type="text" id="toyName" required>
        <br>
        <label for="units Sold:</label>
        <input type="number" id="units" required>
        <br>
        <label for="sellingPrice">Selling Price (INR):</label>
        <input type="number" id="sellingPrice" step="0.01" required>
        <br>
        <label for="paymentMethod">Payment Method:</label>
        <select id="paymentMethod" required>
            <option value="online">online</option>
            <option value="ofline">Ofline</option>
        </select>
        <br>
        <label for="date">Date:</label>
        <input type="date" id="date" required>
        <br>
        <button type="button" onclick="saveSale()">Save Sale</button>
    </form>
    <hr>
    <h2>Sales Analysis</h2>
    <select id="analysisType" onchange="updateAnalysis()">
        <option value="today">Today</option>
        <option value="month">This Month</option>
        <option value="year">This Year</option>
        <option value="custom">Custom Date Range</option>
    </select>
    <div id="customDateRange" style="display: none;">
        <label for="startDate">Start Date:</label>
        <input type="date" id="startDate">
        <label for="endDate">End Date:</label>
        <input type="date" id="endDate">
    </div>
    <br>
    <button type="button" onclick="exportData('json')">Export to JSON</button>
    <button type="button" onclick="exportData('excel')">Export to Excel</button>
    <button type="button" onclick="exportData('pdf')">Export to PDF</button>
    <br>
    <table id="salesTable">
        <thead>
            <tr>
                <th>Toy Name</th>
                <th>Units Sold</th>
                <th>Selling Price</th>
                <th>Total Sales</th>
                <th>Payment Method</th>
                <th>Date</th>
            </tr>
        </thead>
        <tbody id="salesData"></tbody>
    </table>
    <div id="paymentSummary"></div>

    <script>
        // Your web app's Firebase configuration
        const firebaseConfig = {
            apiKey: "[REDACTED:GCP API key]",
            authDomain: "pro1-41035.firebaseapp.com",
            projectId: "pro1-41035",
            storageBucket: "pro1-41035.storage.googleapis.com",
            messagingSenderId: "80430133341", 
            appId: "1:80430133341:web:db7a1a67ab4ac20d9dddb4",
            measurementId: "G-LWKWK2FZLD"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const analytics = firebase.analytics();

        // Initialize sales data from localStorage and Firestore
        let salesData = JSON.parse(localStorage.getItem('salesData')) || [];

        // Sync data with Firestore
        function syncDataWithFirestore() {
            db.").get().then((querySnapshot) => {
                querySnapshot.forEach((doc) => {
                    const sale = doc.data();
                    const existingSaleIndex = salesData.findIndex(s => s.id === doc.id);
                    if (existingSaleIndex !== -1) {
                        salesData[existingSaleIndex] = { id: doc.id, ...sale };
                    } else {
                        salesData.push({ id: doc.id, ...sale });
                    }
                });
                localStorage.setItem('salesData', JSON.stringify(salesData));
                updateAnalysis();
            });
        }

        // Save sale data to Firestore
        function saveSale() {
            const toyName = document.getElementById('toyName').value;
            const units = parseInt(document.getElementById('units').value);
            const sellingPrice = parseFloat(document.getElementById('sellingPrice').value);
            const paymentMethod = document.getElementById('paymentMethod').value;
            const date = document.getElementById('date').value;

            if (!toyName || !units || !sellingPrice || !paymentMethod || !date) {
                alert('Please fill all fields');
                return;
            }

            const sale = {
                toyName,
                units,
                sellingPrice,
                totalSales: units * sellingPrice,
                paymentMethod,
                date,
                timestamp: Date.now()
            };

            db.collection("salesData").add(sale)
                .then((docRef) => {
                    sale.id = docRef.id;
                    salesData.push(sale);
                    localStorage.setItem('salesData', JSON.stringify(salesData));
                    updateAnalysis();
                    clearForm();
                })
                .catch((error) => {
                    console.error("Error adding document: ", error);
                });
        }

        function clearForm() {
            document.getElementById('toyName').value = '';
            document.getElementById('units').value = '';
            document.getElementById('sellingPrice').value = '';
            document.getElementById('paymentMethod').value = '';
            document.getElementById('date').value = '';
        }

        function updateAnalysis() {
            const analysisType = document.getElementById('analysisType').value;
            const customDateRange = document.getElementById('customDateRange');
            
            if (analysisType === 'custom') {
                customDateRange.style.display = 'block';
            } else {
                customDateRange.style.display = 'none';
            }

            const data = filterDataByPeriod(analysisType);
            renderSalesTable(data);
            renderPaymentSummary(data);
        }

        function filterDataByPeriod(period) {
            const today = new Date().setHours(0, 0, 0, 0);
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;

            switch (period) {
                case 'today':
                    return salesData.filter(sale => new Date(sale.date).setHours(0, 0, 0, 0) === today);
                case 'month':
                    return salesData.filter(sale => new Date(sale.date).getMonth() === new Date().getMonth() &&
                                                     new Date(saleFullYear() === new Date().getFullYear());
                case 'year':
                    return salesData.filter(sale => new Date(sale.date).getFullYear() === new Date().getFullYear());
                case 'custom':
                    return salesData.filter(sale => new Date(sale.date) >= new Date(startDate) &&
                                                     new Date(sale.date) <= new Date(endDate));
                default:
                    return salesData;
            }
        }

        function renderSalesTable(data) {
            const salesDataElement = document.getElementById('salesData');
            salesDataElement.innerHTML = '';

            data.forEach(sale => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${sale.toyName}</td>
                    <td>${sale.units}</td>
                    <td>₹${sale.sellingPrice}</td>
                    <td>₹${sale.totalSales}</td>
                    <td>${sale.paymentMethod}</td>
                    <td>${sale.date}</td>
                `;
                salesDataElement.appendChild(row);
            });
        }

        function renderPaymentSummary(data) {
            const paymentMethods = ['cash', 'credit', 'debit'];
            const paymentSummary = paymentMethods.map(method => {
                const totalSales = data
                    .filter(sale => sale.paymentMethod === method)
                    .reduce((sum, sale) => sum + sale.totalSales, 0);
                return `${method.charAt(0).toUpperCase() + method.slice(1)}: ₹${totalSales}`;
            });

            const summaryHTML = `
                <h3>Payment Summary</h3>
                <p>${paymentSummary.join('<br>')}</p>
            `;

            document.getElementById('paymentSummary').innerHTML = summaryHTML;
        }

        function exportData(format) {
            const data = filterDataByPeriod(document.getElementById('analysisType').value);

            switch (format) {
                case 'json':
                    exportToJSON(data);
                    break;
                case 'excel':
                    exportToExcel(data);
                    break;
                case 'pdf':
                    exportToPDF(data);
                    break;
                default:
                    break;
            }
        }

        function exportToJSON(data) {
            const jsonContent = JSON.stringify(data, null, 2);
            downloadFile(jsonContent, 'sales_data.json', 'application/json');
        }

        function exportToExcel(data) {
            let xlsx = '<table><tr><th>Toy Name</th><th>Units Sold</th><th>Selling Price</th><th>Total Sales</th><th>Payment Method</th><th>Date</th></tr>';
            data.forEach(sale => {
                xlsx += `<tr>
                            <td>${sale.toyName}</td>
                            <td>${sale.units}</td>
                            <td>₹${sale.sellingPrice}</td>
                            <td>₹${sale.totalSales}</td>
                            <td>${sale.paymentMethod}</td>
                            <td>${sale.date}</        </tr>`;
            });
            xlsx += '</table>';

            downloadFile(xlsx, 'sales_data.xls', 'application/vnd.ms-excel');
        }

        function exportToPDF(data) {
            let printWindow = window.open('', '', 'height=400,width=800');
            printWindow.document.write('<html><head><title>Sales Data</title>');
            printWindow.document.write('</head><body>');
            printWindow.document.write('<h1>Sales Data</h1>');
            printWindow.document.write(document.getElementById('salesTable').outerHTML);
            printWindow.document.write('</body></html>');
            printWindow.document.close();
            printWindow.print();
        }

        function downloadFile(content, fileName, contentType) {
            const blob = new Blob([content], { type: contentType });
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }

        // Initialize the page and sync data with Firestore
        syncDataWithFirestore();
    </script>
</body>
</html>
